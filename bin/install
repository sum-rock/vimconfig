#!/bin/bash

SRC_PATH=$(cd "$(dirname "${BASH_SOURCE[0]}")" &> /dev/null && pwd)/../src

clear_dirs() {
    if [ -d ~/.vim ]; then
        sudo rm -R ~/.vim
    fi
    if [ -f ~/.vimrc ]; then
        sudo rm ~/.vimrc
    fi
    if [ -d ~/.config/coc ]; then
        sudo rm -R ~/.config/coc
    fi
    # Note that we do not remove TabNine on install. When TabNine is run 
    # for the first time, there is a really annoying browser event that 
    # can be avoided by leaving this alone
}
create_dirs() {
    mkdir -p ~/.vim/colors
    mkdir ~/.config/coc
}

clear_dirs
create_dirs

# Get assets for VimPlug plugin manager
curl -fLo ~/.vim/autoload/plug.vim --create-dirs \
    https://raw.githubusercontent.com/junegunn/vim-plug/master/plug.vim

# Use temp vimrc to install pluggins
cp $SRC_PATH/vimrc.tmp ~/.vimrc
vim -c ":PlugInstall" -c ":q" -c ":q" 
 
# Replace temp vimrc with real one 
rm ~/.vimrc
cp $SRC_PATH/vimrc ~/.vimrc
 
# Move colors into place 
cp ~/.vim/plugged/gruvbox/colors/gruvbox.vim ~/.vim/colors/gruvbox.vim
 
# Install COC Language servers 
vim -c ":CocInstall coc-tabnine coc-tsserver coc-sh coc-markdownlint coc-jedi coc-json coc-rls coc-solargraph" 

# FIXME: This isn't a great exit. I can't add the `-c ":q"` here without 
# nooping the language server installation. 
